<!DOCTYPE html>
<!-- 
	Icons: https://fonts.google.com/icons
-->
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <title>
      Einrichtung einer verteilten Monitoringlösung auf Basis von Prometheus und
      M3 im Bereich des behördlichen Gesundheitswesens
    </title>

    <link rel="stylesheet" href="dist/reset.css" />
    <link rel="stylesheet" href="dist/reveal.css" />
    <link rel="stylesheet" href="dist/theme/white.css" id="theme" />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="dist/custom.css" />
    <link rel="stylesheet" href="dist/asciinema-player.css" />

    <!-- Theme used for syntax highlighted code -->
    <link
      rel="stylesheet"
      href="plugin/highlight/zenburn.css"
      id="highlight-theme"
    />
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section
          data-auto-animate
          data-background-image="assets/monitoring_title.jpg"
          data-transition="slide"
          id="deck"
        >
          <img
            height="150px"
            src="https://prometheus.io/assets/prometheus_logo_grey.svg"
          />
          <p>
            Einrichtung einer verteilten Monitoringlösung auf Basis von
            Prometheus und M3 im Bereich des behördlichen Gesundheitswesens
            <br />
            von <b>Nico Kahlert</b>
          </p>
        </section>
        <!-- Agenda -->
        <section id="agenda" data-auto-animate>
          <span class="material-icons md-big">format_list_numbered_rtl</span>
          <h1>Agenda</h1>
        </section>
        <section data-auto-animate>
          <h1>Agenda</h1>
          <ul id="agenda-index"></ul>
        </section>
        <!-- Vorstellung des Unternehmen -->
        <section data-auto-animate id="Vorstelllung des Unternehmens">
          <span class="material-icons md-big">apartment</span>
          <h1 class="r-fit-text">Vorstellung des Unternehmens</h1>
        </section>
        <section data-auto-animate>
          <h1 class="r-fit-text">Vorstellung des Unternehmens</h1>
          <div class="grid-container">
            <div class="left-grid-item">
              <img src="assets/it-campus.jpg" />
              <h6 class="r-fit-text">IT Campus</h6>
            </div>
            <div class="right-grid-item r-stack">
              <div class="fragment fade-out" data-fragment-index="0">
                <h6>Infos</h6>
                <ul>
                  <li>IT-Dienstleister für den Mittelstand</li>
                  <li>ca. 100 Mitarbeitende</li>
                </ul>
              </div>
              <div class="fragment current-visible" data-fragment-index="0">
                <h6>Weitere Standorte</h6>
                <ul>
                  <li>Hannover</li>
                  <li>Kassel</li>
                  <li>Braunschweig</li>
                </ul>
              </div>
              <div class="fragment fade-in-then-out">
                <h6>Rechenzentren</h6>
                <ul>
                  <li>Braunschweig</li>
                  <li>Hannover</li>
                  <li>Salzgitter</li>
                  <li class="lighter">Limburg (OVH)</li>
                </ul>
              </div>
              <div class="fragment fade-in">
                Langjährige Geschäftsbeziehungen mit dem HZI
              </div>
            </div>
          </div>
        </section>
        <!-- Vorstellung des Kunden -->
        <section data-auto-animate id="Vorstellung des Kunden">
          <span class="material-icons md-big">person</span>
          <h2 class="r-text-fit">Vorstellung des Kunden</h2>
        </section>
        <section data-auto-animate>
          <h2 class="r-text-fit">Vorstellung des Kunden</h2>
          <div class="grid-container">
            <div class="left-grid-item">
              <img
                src="https://www.bundesgesundheitsministerium.de/fileadmin/Dateien/2_Bilder/4_Personen/1_Minister/Pressebilder_2020/DB_BMG_JENS_SPAHN_2020_051_QUER.jpg"
              />
              Bundesministerium für Gesundheit
            </div>
            <div class="right-grid-item">
              <ul class="fragment">
                <li>Jens Spahn</li>
                <li>CDU</li>
                <li>15Mrd € Haushalt</li>
                <li>700 Bedienstete</li>
                <li>Wegweisend für die Gesundheitsämter</li>
              </ul>
            </div>
          </div>
        </section>
        <!-- Sormas -->
        <section data-auto-animate id="Projekteinordnung">
          <img class="icon-bw" src="./assets/sormas.png" />
          <h2 class="r-text-fit">Projekteinordnung</h2>
        </section>
        <section data-auto-animate>
          <h2 class="r-text-fit">Projekteinordnung</h2>
          <div class="grid-container">
            <div class="left-grid-item">
              <h6>SORMAS Projekt</h6>
              <img src="./assets/sormas.png" />
            </div>
            <div class="right-grid-item r-stack">
              <ul class="fragment fade-out" data-fragment-index="0">
                <li>Pandemiemanagementsoftware</li>
                <li>Kontaktverfolgung</li>
                <li>Entwickelt vom HZI/Vitagroup</li>
                <li>DevOps und Operations von NLI</li>
                <li>Hosting im ITZBund RZ</li>
              </ul>
              <ul class="fragment current-visible" data-fragment-index="0">
                <li>400 Instanzen</li>
                <li>Containerisiert</li>
                <li>Updates alle 2 Wochen</li>
                <li>Herausforderung für das Monitoring</li>
              </ul>
            </div>
          </div>
        </section>
        <!-- Planung -->
        <section id="Ablaufplan & Aufwand" data-auto-animate>
          <span class="material-icons md-big">map</span>
          <br />
          <h1 class="r-fit-text">Ablaufplan & Aufwand</h1>
        </section>
        <section data-auto-animate>
          <h1 class="r-fit-text">Ablaufplan & Aufwand</h1>
          <div class="grid-container">
            <img class="left-grid-item legende" src="./assets/legende.jpeg" />
            <div class="r-stack right-grid-item">
              <img
                src="./assets/gantt.jpeg"
                class="fragment fade-out"
                data-fragment-index="0"
              />
              <img
                src="./assets/aufwand.jpeg"
                class="fragment current-visible"
                data-fragment-index="0"
              />
            </div>
          </div>
        </section>
        <!-- Ist-Soll -->
        <section id="IST/SOLL-Analyse" data-auto-animate>
          <span class="material-icons md-big">analytics</span>
          <br />
          <h2 class="r-fit-text">IST/SOLL-Analyse</h2>
        </section>
        <section data-auto-animate>
          <h2 class="r-fit-text">IST/SOLL-Analyse</h2>
          <div class="r-stack">
            <div
              class="fragment fade-out grid-container"
              data-fragment-index="0"
            >
              <img
                class="left-grid-item"
                src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F3%2F38%2FPrometheus_software_logo.svg%2F1200px-Prometheus_software_logo.svg.png"
              />
              <ul class="right-grid-item">
                <li>1 vServer</li>
                <li>4vCPU, 16GB RAM, 500GB SSD</li>
                <li>Prometheus & Grafana</li>
                <li>circa 400 Endpunkte</li>
                <li>Scraping: 468 MB/min</li>
              </ul>
            </div>
            <div
              class="fragment current-visible grid-container"
              data-fragment-index="0"
            >
              <img
                class="icon left-grid-item"
                src="https://github.com/m3db/m3/raw/master/site/static/images/logo-square.png"
              />
              <ul class="right-grid-item">
                <li>3 vServer</li>
                <li>4 vCPU, 8 GB RAM, 500GB SSD</li>
                <li>Prometheus, M3DB, Consul & Grafana</li>
              </ul>
            </div>
            <div class="fragment fade-in-then-out grid-container">
              <div class="left-grid-item">
                <h6>Cluster Topologie</h6>
                <img src="assets/netzwerkdiagramm.png" />
              </div>
              <div class="right-grid-item">
                <h6>Node Topologie</h6>
                <img src="assets/node_configuration_diagram.svg" />
              </div>
            </div>
            <div class="fragment fade-in grid-container">
              <h6 class="left-grid-item">Nutzen</h6>
              <ul class="right-grid-item">
                <li>No Single Point of Failure</li>
                <li>Horizontal Skalierbar</li>
                <li>Wachsende Community</li>
                <li>Aggregation inklusive</li>
              </ul>
            </div>
          </div>
        </section>
        <!-- Konstruktion von Playbook & Rollen -->
        <section data-auto-animate id="Konstruktion von Playbook & Rollen">
          <span class="material-icons md-big">code</span>
          <br />
          <h1 class="r-fit-text">Konstruktion von Playbook & Rollen</h1>
        </section>
        <section data-auto-animate>
          <h1 class="r-fit-text">Konstruktion von Playbook & Rollen</h1>
          <pre><code data-trim data-noescape>
---
- name: Setup Distributed Prometheus
  hosts: all
  become: yes
  remote_user: root
  roles:
  - cloudalchemy.node_exporter
  - common
  - consul
  - etcd
  - m3db
  - prometheus
  - grafana
          </code></pre>
          <small>Playbook main.yml</small>
        </section>
        <section class="diagram-slide" data-auto-animate>
          <h1 class="r-fit-text">Konstruktion von Playbook & Rollen</h1>
          <h6>Common Rolle</h6>
          <!--
          <ul>
            <li>Setzen des Hostname</li>
            <li class="fragment">Aktivieren der Firewall</li>
            <li class="fragment">Installation des EPEL Repository</li>
            <li class="fragment">Installation von Podman</li>
          </ul>-->
          <span class="diagram-data" style="display:none;">
            graph TD
            A(Hostname ist gesetzt) --> |ok| B(Firewall ist aktiv)
            B --> |ok| C(EPEL Repository ist konfiguriert)
            C --> |ok| D(Pakete sind installiert z.B. podman)
            D --> |ok| E(Zeitzone ist konfiguriert)
          </span>
          <div class="diagram-display">
          </div>
        </section>
        <section class="diagram-slide" data-auto-animate>
          <h1 class="r-fit-text">Konstruktion von Playbook & Rollen</h1>
          <h6>Consul Rolle</h6>
          <!--<ul>
            <li>Öffnen der Ports in der Firewall</li>
            <li class="fragment">Erstellen der Data-/Configfolder</li>
            <li class="fragment">Starten des Consul Server Containers</li>
            <li class="fragment">Starten des Consul Agent Containers</li>
            <li class="fragment">Warten auf Readiness</li>
          </ul>-->
          <span class="diagram-data" style="display:none;">
            graph TD
            A(Ports in der Firewall sind offen) --> |ok| B(Data-/Configfolder sind vorhanden)
            B --> |ok| C(Consul Server Container läuft)
            C --> |ok| D(Consul Agent Container laufen)
            D --> |ok| E(Status ist Ready)
          </span>
          <div class="diagram-display">
          </div>
        </section>
        <section class="diagram-slide" data-auto-animate>
          <h1 class="r-fit-text">Konstruktion von Playbook & Rollen</h1>
          <h6>ETCD Rolle</h6>
          <!--<ul>
            <li>Öffnen der Ports in der Firewall</li>
            <li class="fragment">Erstellen der Data-/Configfolder</li>
            <li class="fragment">Starten des ETCD Containers</li>
            <li class="fragment">Warten auf Readiness</li>
          </ul>-->
          <span class="diagram-data" style="display:none;">
            graph TD
            A(Ports in der Firewall sind offen) --> |ok| B(Data-/Configfolder sind vorhanden)
            B --> |ok| C(ETCD Server Container laufen)
            C --> |ok| D(Status ist Ready)
          </span>
          <div class="diagram-display">
          </div>
        </section>
        <section class="diagram-slide" data-auto-animate>
          <h1 class="r-fit-text">Konstruktion von Playbook & Rollen</h1>
          <h6>M3DB Rolle</h6>
          <!--<ul>
            <li>Kernelkonfigurationen</li>
            <li class="fragment">Öffnen der Ports in der Firewall</li>
            <li class="fragment">Erstellen der Data-/Configfolder</li>
            <li class="fragment">Erstellen der Konfigurationdatei</li>
            <li class="fragment">Starten des M3DB Containers</li>
            <li class="fragment">Erstellen eines Namespace</li>
            <li class="fragment">Konfiguration der Platzierung</li>
            <li class="fragment">Erstellen einer Datenbank</li>
            <li class="fragment">Warten auf Readiness</li>
          </ul>-->
              <span class="diagram-data" style="display:none;">
                graph TB
                A(Ports in der Firewall sind offen) --> |ok| B(Data-/Configfolder sind vorhanden)
                B --> |ok| C(Konfigurationdatei ist templated)
                C --> |ok| D(M3DB Container laufen)
                E(Namespace ist konfiguriert)--> |ok| F(Placement ist konfiguriert)
                F --> |ok| G(Datenbank ist erstellt)
                G --> |ok| H(Status ist Ready)
              </span>
              <div class="diagram-display">
              </div>
          
        </section>
        <section class="diagram-slide" data-auto-animate>
          <h1 class="r-fit-text">Konstruktion von Playbook & Rollen</h1>
          <h6>Prometheus Rolle</h6>
          <!--<ul>
            <li>Öffnen des Ports in der Firewall</li>
            <li class="fragment">Erstellen der Configfolder</li>
            <li class="fragment">Erstellen der Konfigurationdatei</li>
            <li class="fragment">Starten des Prometheus Containers</li>
          </ul>-->
          <span class="diagram-data" style="display:none;">
            graph TD
            A(Ports in der Firewall sind offen) --> |ok| B(Configfolder sind vorhanden)
            B --> |ok| C(Konfigurationdatei ist templated)
            C --> |ok| D(Prometheus Container laufen)
          </span>
          <div class="diagram-display">
          </div>
        </section>
        <section data-auto-animate>
          <h1 class="r-fit-text">Prometheuskonfiguration</h1>
          <pre><code data-trim data-noescape data-line-numbers="2-4|5-6|7-9|9-13">
# prometheus.yml.j2
global:
  scrape_interval: 15s
  evaluation_interval: 15s
remote_write:
- url: "http://localhost:7201/api/v1/prom/remote/write"
scrape_configs:
- job_name: 'consul_services'
  consul_sd_configs:
  - server: "127.0.0.1:8500"
    datacenter: "{{ consul_datacenter }}"
    scheme: http
    refresh_interval: "60s"
					</code></pre>
          <small>Template der Prometheuskonfiguration</small>
        </section>
        <section class="diagram-slide" data-auto-animate>
          <h1 class="r-fit-text">Konstruktion von Playbook & Rollen</h1>
          <h6>Grafana Rolle <span class="lighter">- Node 0</span></h6>
          <!--<ul>
            <li>Öffnen des Ports in der Firewall</li>
            <li class="fragment">Erstellen der Data-/Configfolder</li>
            <li class="fragment">Erstellen der Konfigurationdatei</li>
            <li class="fragment">Starten des Grafana Containers</li>
          </ul>-->
          <span class="diagram-data" style="display:none;">
            graph TD
            A(Ports in der Firewall sind offen) --> |ok| B(Data-/Configfolder sind vorhanden)
            B --> |ok| C(Konfigurationdatei ist getemplated)
            C --> |ok| D(Grafana Container läuft)
          </span>
          <div class="diagram-display">
          </div>
        </section>
        <!-- Durchführung -->
        <section id="Installation" data-auto-animate>
          <span class="material-icons md-big">play_arrow</span>
          <h1 class="r-fit-text">Installation</h1>
        </section>
        <section data-auto-animate>
          <h1 class="r-fit-text">Installation</h1>
          <asciinema-player
            id="player"
            speed="2"
            theme="solarized-light"
            preload
            src="assets/provisioning.cast"
            cols="250"
            rows="25"
            start-at="200"
            poster="npt:3:20"
          ></asciinema-player>
        </section>
        <!-- Fazit -->
        <section id="Fazit" data-auto-animate>
          <span class="material-icons md-big">trending_up</span>
          <h1>Fazit</h1>
        </section>
        <section data-auto-animate>
          <h1>Fazit</h1>
          <div class="r-stack">
            <img
              class="fragment fade-out"
              data-fragment-index="0"
              src="assets/consul_services_added.png"
            />
            <img
              class="fragment current-visible"
              data-fragment-index="0"
              src="assets/prometheus_service_discovery.png"
            />
            <img
              class="fragment fade-in-then-out"
              src="assets/m3db_grafana_dashboard.png"
            />
            <div class="fragment fade-in grid-container">
              <div class="left-grid-item">
                <h6>Monitoring</h6>
                <ul>
                  <li>Ausfalltoleranz</li>
                  <li>Reproduzierbar</li>
                  <li>Dynamisch</li>
                </ul>
              </div>
              <div class="right-grid-item">
                <h6>Planung</h6>
                <ul>
                  <li>Verschiebung in den Rollen</li>
                  <li>In sich stimmig</li>
                  <li>Viel gelernt!</li>
                </ul>
              </div>
            </div>
          </div>
        </section>
        <!-- Quellen -->
        <section
          id="Quellen"
          data-auto-animate
          data-background-color="var(--haze)"
        >
          <h2 class="r-fit-text">Quellen</h2>
          <pre><code data-trim data-noescape>
https://www.bundesgesundheitsministerium.de/
https://www.sormas-oegd.de/
https://www.itzbund.de/
https://etcd.io/
https://m3db.io
https://etcd.io/docs/v3.4/op-guide/configuration/
https://www.youtube.com/watch?v=CcH13GyszHI
https://www.itzbund.de/DE/home/home_node.html
https://www.youtube.com/watch?v=gqwcUgZOoyI
https://prometheus.io/docs/
https://docs.ansible.com/ansible/latest/user_guide/
https://www.ansible.com/resources/whitepapers
https://grafana.com/docs
https://podman.io/
          </code></pre>
        </section>
        <!-- Danksagung -->
        <section data-auto-animate data-background-color="var(--haze)">
          <h2 class="r-fit-text">Danke für Ihre Aufmerksamkeit</h2>
          <h3 class="r-fit-text">Haben Sie noch Fragen?</h3>
        </section>
        <section data-auto-animate data-background-color="var(--haze)">
          <h2 class="r-fit-text">Danke für Ihre Aufmerksamkeit</h2>
          <h3 class="r-fit-text">Haben Sie noch Fragen?</h3>
          <div id="qr-code"></div>
          <small
            >Und
            <a href="https://github.com/nk-designz/distributed_prometheus"
              >hier</a
            >
            geht es online weiter
          </small>
        </section>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script src="dist/reveal.js"></script>
    <script src="dist/qrcode.min.js"></script>
    <script src="dist/asciinema-player.js"></script>
    <script src="plugin/chart/chart.min.js"></script>
    <script src="plugin/chart/plugin.js"></script>
    <script src="plugin/notes/notes.js"></script>
    <script src="plugin/markdown/markdown.js"></script>
    <script src="plugin/highlight/highlight.js"></script>
    <script src="dist/custom.js"></script>
  </body>
</html>
